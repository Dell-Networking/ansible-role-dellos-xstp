#jinja2: trim_blocks: True, lstrip_blocks: True
{###############################################
PURPOSE: Configure xSTP on OS10 Devices

################################################
Example:
dellos_xstp:
  OS10:
    type: mst
    pvst_vlans: 2,11
    bridge_priority: 4096
    mstp_instances:
      - number: 1
        vlans: 10,12
        bridge_priority: 4096
        vlans_state: present
    state: present

#################################################}

{% set xstp_vars = dellos_xstp[hostname] %}
{% if xstp_vars.type is defined and xstp_vars.type %}
  {% if xstp_vars.state is defined and xstp_vars.state == "absent" %}
no spanning-tree mode {{ xstp_vars.type }}
  {% else %}
spanning-tree mode {{ xstp_vars.type }}
    {% if xstp_vars.type == "rstp" %}
      {% if xstp_vars.bridge_priority is defined and xstp_vars.bridge_priority %}
spanning-tree {{ xstp_vars.type }} priority {{ xstp_vars.bridge_priority }}
      {% else %}
no spanning-tree {{ xstp_vars.type }} priority
      {% endif %}
    {% endif %}

    {% if xstp_vars.type == "rapid-pvst" %}
      {% if xstp_vars.pvst_vlans is defined and xstp_vars.pvst_vlans %}
        {% if xstp_vars.bridge_priority is defined and xstp_vars.bridge_priority %}
spanning-tree vlan {{ xstp_vars.pvst_vlans }} priority {{ xstp_vars.bridge_priority }}
        {% else %}
no spanning-tree vlan {{ xstp_vars.pvst_vlans }} priority
        {% endif %}
      {% endif %}
    {% endif %}

    {% if xstp_vars.type == "mst" %}
      {% if xstp_vars.mstp_instances is defined and xstp_vars.mstp_instances %}
        {% for instance in xstp_vars.mstp_instances %}
          {% if instance.number is defined and instance.number %}
spanning-tree {{ xstp_vars.type }} configuration
            {% if instance.vlans is defined and instance.vlans %}
              {% if instance.vlans_state is defined and instance.vlans_state == "absent" %}
 no instance {{ instance.number }} vlan {{ instance.vlans }}
              {% else %}
 instance {{ instance.number }} vlan {{ instance.vlans }}
              {% endif %}
            {% endif %}
          {% endif %}
        {% endfor %}
      {% endif %}
    {% endif %}

  {% endif %}
{% endif %}
